CODE SEGMENT
	ASSUME CS:CODE
	
	CLI 
	MOV AL,13H;ICW1
	MOV DX,0020H
	OUT DX,AL

	MOV AL,08H;ICW2 
	MOV DX,0021H
	OUT DX,AL
	
	MOV AL,01H;ICW4
	MOV DX,0021H
	OUT DX,AL
	
	MOV AL,2FH;0CW1
	MOV DX,0021H
	OUT DX,AL
	
	MOV AL,80H;OCW2设置自动循环
	MOV DX,0020H
	OUT DX,AL
	STI
	
	CLI 
	MOV AX,0
	MOV ES,AX
	MOV DI,38H
	MOV AX,OFFSET INTP6
	CLD 
	STOSW
	MOV AX,SEG INTP6
	STOSW
	STI
	
	CLI
	MOV AX,0
	MOV ES,AX
	MOV DI,3CH
	MOV AX,OFFSET INTP7
	CLD
	STOSW
	MOV AX,SEG INTP7
	STOSW
	STI
	
MAIN PROC FAR
	MOV DX,0646H
	MOV AL,80H
	OUT DX,AL
	
	MOV DX,0642H
	MOV AL,80H
	OUT DX,AL
	
L1:	STI
	MOV BL,00H
	JMP L1
MAIN ENDP

INTP6 PROC FAR
	STI
	MOV DX,0642H
	IN AL,DX
	
L3:	MOV BH,00H
	CMP BL,BH
	JNE L2
	
	CMP AL,01H
	JE L2
	SHR AL,1
	OUT DX,AL
	
	MOV CX,0FFFFH
LL1:  LOOP LL1
	MOV CX,0FFFFH
LL2:  LOOP LL2
	MOV CX,0FFFFH
LL3:  LOOP LL3

	JMP L3
	
	CLI
L2: MOV AL,0A0H;0CW2 ISR最高优先级不为0置0
	MOV DX,0020H
	OUT DX,AL
	MOV BL,06H
	STI
	IRET
INTP6 ENDP

INTP7 PROC FAR
	STI
	MOV DX,0642H
	IN AL,DX
	
L4:	MOV BH,00H
	CMP BL,BH
	JNE L5
	
	CMP AL,80H
	JE L5
	SHL AL,1
	OUT DX,AL
	
	MOV CX,0FFFFH
LL4:  LOOP LL4
	MOV CX,0FFFFH
LL5:  LOOP LL5
	MOV CX,0FFFFH
LL6:  LOOP LL6

	JMP L4
	CLI
L5: MOV AL,0A0H;0CW2 ISR最高优先级不为0置0
	MOV DX,0020H
	OUT DX,AL
	MOV BL,07H
	STI
	IRET
INTP7 ENDP

CODE ENDS
	END
	