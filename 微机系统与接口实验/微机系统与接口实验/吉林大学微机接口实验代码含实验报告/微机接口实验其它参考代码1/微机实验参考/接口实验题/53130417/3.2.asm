CODE SEGMENT
	ASSUME CS:CODE
	CLI 
	MOV AL,13H;ICW1
	MOV DX,0020H
	OUT DX,AL

	MOV AL,18H;ICW2 
	MOV DX,0021H
	OUT DX,AL
	
	MOV AL,03H;ICW4
	MOV DX,0021H
	OUT DX,AL
	
	MOV AL,2FH;0CW1
	MOV DX,0021H
	OUT DX,AL
	STI
	
	CLI 
	MOV AX,0
	MOV ES,AX
	MOV DI,78H
	MOV AX,OFFSET INTP6
	CLD 
	STOSW
	MOV AX,SEG INTP6
	STOSW
	STI
	
	CLI
	MOV AX,0
	MOV ES,AX
	MOV DI,7CH
	MOV AX,OFFSET INTP7
	CLD
	STOSW
	MOV AX,SEG INTP7
	STOSW
	STI
	
MAIN PROC FAR
	STI
	MOV DX,0646H
	MOV AL,80H
	OUT DX,AL
	
	MOV DX,0642H
	MOV AL,80H
	OUT DX,AL
	
	AND BX,0000H
	MOV BL,01H
	
L1:	
	IN AL,DX
	
	MOV BH,01H
	CMP BL,BH
	JE KEEP
	
	MOV BH,00H
	CMP BL,BH
	JNE L2
	MOV BH,80H
	CMP AL,BH
	JNE LEFT
	
L2:	MOV BH,02H
	CMP BL,BH
	JNE KEEP
	MOV BH,01H
	CMP AL,BH
	JNE RIGHT
	
KEEP: OUT DX,AL
	JMP L1

LEFT: SHL AL,1

	MOV CX,0FFFFH
P1:	LOOP P1
	MOV CX,0FFFFH
P2:	LOOP P2
	MOV CX,0FFFFH
P3:	LOOP P3

	OUT DX,AL
	JMP L1
	
RIGHT: SHR AL,1 

	MOV CX,0FFFFH
P4:	LOOP P4
	MOV CX,0FFFFH
P5:	LOOP P5
	MOV CX,0FFFFH
P6:	LOOP P6

	OUT DX,AL
	JMP L1
	
MAIN ENDP

INTP6 PROC FAR
	MOV BL,02H
	STI
	IRET
INTP6 ENDP

INTP7 PROC FAR
	MOV BL,00H
	STI
	IRET
INTP7 ENDP

CODE ENDS
	END