STACK	SEGMENT
STA	DB	50	DUP(?)
TOP	EQU	LENGTH	STA
STACK	ENDS
CODE	SEGMENT
	ASSUME	CS:CODE,SS:STACK
START:	
	MOV	AX,TOP
	MOV	SP,AX	;保护现场
	
	MOV	AL,080H	;1000	0000
	MOV	DX,0646H
	OUT	DX,AL	;设置8255
	
	PUSH	DS	
	MOV	AX,OFFSET	IRQ0;取中断IRQ0地址
	MOV	SI,38H
	MOV	[SI],AX
	MOV	AX,CS
	MOV	SI,3AH
	MOV	[SI],AX
	
	MOV	AX,OFFSET	IRQ1;取中断IRQ1地址
	MOV	SI,3CH
	MOV	[SI],AX
	MOV	AX,CS
	MOV	SI,3EH
	MOV	[SI],AX
	POP	DS
	

	CLI	
	MOV AL,13H
	MOV	DX,20H
	OUT DX,AL	;ICW1
	MOV AL,08H
	MOV DX,21H
	OUT DX,AL	;ICW2
	MOV AL,03H
	MOV DX,21H
	OUT DX,AL	;ICW4	
	MOV DX,21H
	MOV AL,3FH	;OCW1
	OUT DX,AL
	STI


DSP:
	STI	
	MOV	AL,80H
	MOV	DX,0642H
	OUT	DX,AL
	MOV	AH,0
	
DSP1:
	STI	
	CMP	AH,0
	JZ	DSP2
	CMP	AL,01H
	JZ	B
	SHR AL,1
	JMP	B
DSP2:
	CMP	AL,80H
	JZ	B
	SHL AL,1
B:	MOV	DX,0642H
	OUT	DX,AL
	MOV	CX,0FFFFH
	LOOP	$	;延时
	MOV	CX,0FFFFH
	LOOP	$	;延时
	JMP	DSP1
	
IRQ0:
	MOV	AH,1
	IRET
IRQ1:
	MOV	AH,0
	IRET
	
	CODE	ENDS
	END	START