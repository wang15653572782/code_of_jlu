CODE SEGMENT
	ASSUME CS:CODE
MAIN PROC FAR
;初始化8259
	CLI
	MOV DX,0020H
	MOV AL,13H
	OUT DX,AL;ICW1
	MOV DX,0021H
	MOV AL,08H
	OUT DX,AL;ICW2
	MOV AL,01H
	OUT DX,AL;ICW4
	STI
;设置中断程序
	CLI
	;;设置int6的终中断程序
	MOV AX,0
	MOV ES,AX
	MOV DI,38H
	MOV AX,OFFSET INT6
	CLD
	STOSW;保存段内偏移
	MOV AX,SEG INT6
	STOSW;保存段基地址
	
	;;设置int7的终中断程序
	MOV AX,0
	MOV ES,AX
	MOV DI,3CH
	MOV AX,OFFSET INT7
	CLD
	STOSW;保存段内偏移
	MOV AX,SEG INT7
	STOSW;保存段基地址
	STI
	
	
;初始化8255	
	MOV DX,0646H
	MOV AL,80H
	OUT DX,AL
	MOV DX,0642H
	MOV AL,0FFH
	OUT DX,AL;初始化PB
	
L1: MOV DX,0642H
	MOV AL,0FFH
	OUT DX,AL
	JMP L1	
	
	MOV AH,4CH
	INT 21H


INT6 PROC FAR	
	STI
	PUSH AX
	PUSH DX
	MOV DX,0642H
	MOV AL,0FH
	OUT DX,AL
	CALL DELAY
	MOV DX,0020H
	MOV AL,27H
	OUT DX,AL;OCW2
	POP DX
	POP AX
	IRET
INT6 ENDP

INT7 PROC FAR
	
	STI
	PUSH AX
	PUSH DX
	MOV DX,0642H
	MOV AL,0F0H
	OUT DX,AL
	CALL DELAY
	MOV DX,0020H
	MOV AL,27H
	OUT DX,AL;OCW2
	POP DX
	POP AX
	IRET
INT7 ENDP

DELAY PROC NEAR
	PUSH DX
	PUSH CX
 	MOV DX,000FH
LL1:MOV CX,0FFFFH
	LOOP $
	SUB DX,1
	JNZ LL1
	POP CX
	POP DX
	RET
DELAY ENDP
MAIN ENDP
CODE ENDS
	END MAIN
	