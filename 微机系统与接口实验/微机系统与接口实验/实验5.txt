DATA SEGMENT
	SIGN DB 00H
DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE,DS:DATA
	
START:
	MOV AX,0000H
	MOV DS,AX
	
	MOV AX,OFFSET MIR7
	MOV SI,003CH
	MOV [SI],AX
	MOV AX,CS
	MOV SI,003EH
	MOV [SI],AX
	
	CLI;关中断
 	;设置icw1~icw4和ocw1
 	MOV AL,11H
 	OUT 20H,AL
 	MOV AL,08H
 	OUT 21H,AL
 	MOV AL,04H
 	OUT 21H,AL
 	MOV AL,07H
 	OUT 21H,AL
 	MOV AL,2FH
 	OUT 21H,AL
 	STI;关中断
 
 MAIN:
 	CMP SIGN,00H
 	JE JUCHI
 	CMP SIGN,01H
 	JE JUXING
 	CMP SIGN,02H
 	JE SANJIAO
 	CMP SIGN,03H
 	JE JIETI
 	JMP MAIN
 	
 	MOV CX,05H
 JUCHI:
 	CMP SIGN,0H
 	JNE MAIN
 	MOV DX,0600H
 	MOV AL,00H
 JC1:
 	OUT DX,AL
 	CALL DELAY1 ;短延时
 	CMP AL,0FFH
 	JE JC2
  	
  	INC AL
  	JMP JC1
 JC2:
 	LOOP JUCHI
 	
 	
 	MOV CX,05H
 JUXING:
 	CMP SIGN,01H
 	JNE MAIN
 	MOV DX,0600H
 	MOV AL,00H
 	OUT DX,AL
 	CALL DELAY2 ;长延时
 	MOV AL,0FFH
 	OUT DX,AL
 	CALL DELAY2
 	LOOP JUXING
 	
 ZHONGJIAN:JMP MAIN
 
 	MOV CX,05H
 SANJIAO:
 SJ1:
 	CMP SIGN,02H
 	JNE MAIN
 	MOV DX,0600H
 	OUT DX,AL
 	
 	CALL DELAY1
 	CMP AL,0FFH
 	JE SJ2
 	INC AL
 	JMP SJ1
 SJ2:
 	MOV DX,0600H
 	OUT DX,AL
 	CALL DELAY1
 	CMP AL,00H
 	JE SJ3
 	DEC AL
 	JMP SJ2
 SJ3:
 	LOOP SANJIAO
 	
 JIETI:
 	MOV CX,05H
 	MOV AX,0FEH
 	
 	MOV BL,05H
 	DIV BL
 	MOV BL,AL
 	MOV BH,00H
 JIETI1:
 	CMP SIGN,03H
 	JNE ZHONGJIAN
 	MOV AX,0000H
 JT1:
 	MOV DX,0600H
 	OUT DX,AL
 	CMP AX,00FFH
 	JAE JT2
 	CALL DELAY2
 	
 	ADD AX,BX
 	JMP JT1
 JT2:
 	LOOP JIETI1
 MIR7:
 	PUSH AX
 	CMP SIGN,03H
 	JE SET0
 	INC SIGN
 	JMP QUIT
 SET0:
 	MOV SIGN,0H
 QUIT:
 	POP AX
 	IRET
 	
 DELAY1: ;短延时
 	PUSH CX
 	MOV CX,01FFH
 DE1:
 	PUSH AX
 	POP AX
 	LOOP DE1
 	POP CX
 	RET
 	
 DELAY2: ;长延时
 	PUSH CX
 	MOV CX,0FFFFH
 DE2:
 	PUSH AX
 	POP AX
 	LOOP DE2
 	POP CX
 	RET
 	
 CODE ENDS
 	END START
 