DATA SEGMENT
 	SIGN DB 00H
DATA ENDS
CODE SEGMENT
 	ASSUME CS:CODE,DS:DATA
 START:
 	MOV AX,0000H
 	MOV DS,AX
 	
 	
 	MOV DX,0646H
 	MOV AL,90H
 	OUT DX,AL
 	
 	;设置中断向量
 	MOV AX,OFFSET MIR6
 	MOV SI,0038H
 	MOV [SI],AX
 	MOV AX,CS
 	MOV SI,003AH
 	MOV [SI],AX
 	
 	MOV AX,OFFSET MIR7
 	MOV SI,003CH
 	MOV [SI],AX
 	MOV AX,CS
 	MOV SI,003EH
 	MOV [SI],AX
 	
 	CLI;关中断
 	;设置icw1~icw4和ocw1
 	MOV AL,11H
 	OUT 20H,AL
 	MOV AL,08H
 	OUT 21H,AL
 	MOV AL,04H
 	OUT 21H,AL
 	MOV AL,07H
 	OUT 21H,AL
 	MOV AL,2FH
 	OUT 21H,AL
 	STI;关中断
 	
 AA1:	;主程序，让灯全亮
 	MOV DX,0642H
 	MOV AL,0FFH
 	OUT DX,AL
 	JMP AA1
 MIR6:
 	MOV DX,0642H
 	MOV AL,0FH
 	OUT DX,AL; 亮绿灯
 	CALL DELAY
 	CALL DELAY
 	CALL DELAY
 	CALL DELAY
 	CMP SIGN,01H;判断sign是否为1
 	JZ RED;若为1则调到red
 	JMP BACK;中断返回
 RED:	;绿灯亮完后红灯亮
 	MOV DX,0642H
 	MOV AL,0F0H;
 	OUT DX,AL
 BACK:
  IRET
  
 MIR7:
 	STI
 	MOV SIGN,01H;sign置1表示发生当前中断
 	MOV DX,0642H
 	MOV AL,0F0H
 	OUT DX,AL
 	CALL DELAY
 	CALL DELAY
 	CALL DELAY
 	CALL DELAY
 	MOV SIGN,00H;执行完恢复标志位0
 	IRET
 	
 ;
 DELAY PROC NEAR
 	MOV CX,0FFFFH
 	LOOP $
 	RET
 DELAY ENDP
 
 
 CODE ENDS
 END START